{% extends "layout.html" %}
{% block content %}
<div>
    <div class="dashboard-header">
        <div class="user-info">
            <h1>Xin ch√†o, <span class="username">{{ user.username }}</span> üëã</h1>
            <p>ƒêi·ªÉm t√≠ch l≈©y: <span class="points">{{ user.points }}</span></p>
        </div>
        <a class="logout-btn" href="{{ url_for('logout') }}">üö™ ƒêƒÉng xu·∫•t</a> 
    </div>

    <div class="cart-container">
        <h2>üõí Gi·ªè H√†ng C·ªßa B·∫°n ({{ cart|length }})</h2>
        
        {% if cart %}
        <ul>
            {% for item in cart %}
            <li>
                <img src="{{ item[5] or url_for('static', filename='images/default_book.jpg') }}" 
                     alt="{{ item[2] }}" 
                     class="cart-book-img"
                     width="50" height="70">
                <div>
                    <p>{{ item[2] }}</p>
                    <p>{{ item[3] }}</p>
                </div>
            </li>
            {% endfor %}
        </ul>
        
        <a href="{{ url_for('checkout') }}">
            ‚úÖ X√°c Nh·∫≠n M∆∞·ª£n S√°ch (Checkout)
        </a>
        
        {% else %}
        <p>Gi·ªè h√†ng tr·ªëng. H√£y ch·ªçn s√°ch b·∫°n mu·ªën m∆∞·ª£n!</p>
        {% endif %}
    </div>

    <hr>

    <h2>üìö Danh s√°ch s√°ch c√≥ s·∫µn</h2>
    <div class="book-list-grid"> {% for book in books %}
        <div class="book-card-item">
            
            <img src="{{ book.image_url or url_for('static', filename='images/default_book.jpg') }}" 
                alt="B√¨a s√°ch {{ book.title }}" 
                class="book-list-img">
            
            <h3>{{ book.title }}</h3>
            <p>{{ book.author }}</p>
            <p>{{ book.category }}</p>
            <p>C√≤n l·∫°i: 
                <span>
                    {{ book.available }}
                </span> / {{ book.quantity }}
            </p>

            <div>
                {% if book.available > 0 %}
                    <a href="{{ url_for('add_to_cart', book_id=book.id) }}" class="add-to-cart-btn">
                        üõí Th√™m v√†o Gi·ªè
                    </a>
                {% else %}
                    <button disabled class="out-of-stock-btn">
                        H·∫øt S√°ch
                    </button>
                {% endif %}
            </div>
        </div>
        {% else %}
        <p>Kh√¥ng c√≥ s√°ch n√†o trong th∆∞ vi·ªán üò¢</p>
        {% endfor %}
    </div>

    <hr>

    <h2>üìñ S√°ch B·∫°n ƒêang M∆∞·ª£n</h2>
    <div>
        {% if borrowed %}
        <ul>
            {% for trans in borrowed %}
            <li>
                
                <img src="{{ trans[5] or url_for('static', filename='images/default_book.jpg') }}" 
                     alt="{{ trans[1] }}" 
                     width="50" height="70">
                
                <div>
                    <p>{{ trans[1] }}</p>
                    <p>T√°c gi·∫£: {{ trans[2] }}</p>
                    <p>H·∫°n tr·∫£: {{ trans[4] }}</p>
                </div>
                
                <a href="{{ url_for('return_book', transaction_id=trans[0]) }}">
                    ‚Ü©Ô∏è Tr·∫£ S√°ch
                </a>
                
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>B·∫°n ch∆∞a m∆∞·ª£n s√°ch n√†o üì≠</p>
        {% endif %}
    </div>
</div>
{% endblock %}